# Universal forms

Универсальный компонент SMTP отправки

## Getting Started
### 1. Утсановка
* **Скачать файлы** с репозитория
* **Разместить папку** с скачанными файлами **‘uForm’** в удобном месте (по умолчанию в корневой каталог сайта)
    * Если папка ‘uForm’ размещается не в корне сайта, то необходимо указать путь к ней в файле ‘uForm/js/script.js’
    
     ![alt text](https://i.imgur.com/6saAuaT.jpg "JS Config")
* **Подключаем ‘uForm/js/script.js’** пониже, на страницах где размещена форма (или другой путь к указанному файлу)
```sh
<script src="/uForm/js/script.js"></script>
```


### 2.	Размещение форм
* Готовый образец формы, с модальным окном и их стилями + проверка от спама ботами в файле ‘uForm/index.php’
* Копируем форму в предполагаемое место размещения
* Дублируем и удаляем ненужные поля формы. **Обязательно**: не забываем менять ‘id’ и ‘name’ полей!
* Копируем стили формы, в какой-нибудь уже подключенный .css файл, или создаем и подключаем новый. И редактируем стили в соответствии с макетом сайта

#### 2.1	При необходимости добавить более одной формы на странице:
* Во всех последующих формах на одной странице, **обязательно изменить**:
    * id формы
    * id всех полей
    * для HTML тегов отвечающие за вывод уведомлений 
("uForm__error-msg", "uForm__modal", "uForm__overlay", "uForm__reset"), необходимо в существующий ID дописать префикс (любой, но одинаковый для одной формы). Этот префикс далее указывается в JS конфиге и определяет какие поля к какой форме относятся.

        Пример:

        >"uForm__error-msg **_2**", "uForm__modal **_2**", "uForm__overlay **_2**", "uForm__reset **_2**",
        >
        >"uForm__error-msg **_new**", "uForm__modal **_new**", "uForm__overlay **_new**", "uForm__reset **_new**"

* строку:
    ```sh
    <input class="uForm__extended " name="nospam" type="text" value="uform-empty" required>
    ```
и его стиль:
.uForm__extended {
  display: none;
 }, 
отвечает за защиту от спам-ботов, **не стоит его удалять**.

### 3.	Настройка формы в JS файле

* настройка формы на фронте производиться в файле: **‘uForm/js/script.js’**
* **handlerType** – общая настройка, отвечающая за стиль отображения уведомлений:

    **modal** – отображать уведомления во всплывающем окне. После успешной отправки, форма очищается;

    **message** – при выводе уведомления, удаляется форма, а не ее месте выводится уведомление
* **uFormFilePath** – путь к папке с файлами формы (по умолчанию - /uForm/, файлы при этом размещаются в папке uForm, корневого каталога сайта)
* **failMessage** – общее сообщение об ошибке, выводится в случае возникновения ошибки на стороне бека
* **successMessage** - общее сообщение об успешной отправке запроса
* const **uForms** – список id всех обрабатываемых форм, настройки для каждой формы и их полей
    * handlerType - стиль отображения уведомлений (можно переопределить на нужный)
    * failMessage – текст сообщения об ошибке (можно переопределить на нужный)
    * successMessage – текст сообщения об успешной отправке (можно переопределить на нужный)
    * **refix** – если несколько форм на странице, указывается префикс для каждой из них, где для HTML тегов отвечающие за вывод уведомлений добавлены префиксы. См. п.  2.1.а.3 
    * **validation** – валидация полей. Указываются только те поля, которые необходимо дополнительно проверять

Доступны следующие функции валидаций:

* **validLen(minLen, maxLen)** – позволяет вводить от minLen до maxLen символов, иначе выведет уведомление об ошибке;

* **validCountFiles(n)** - позволяющая загружать не более n файлов

* **validSizeOneFiles(msxSize, type (default – ‘КБ’))** -  позволяющая загружать файлы, размер каждого не может превышать **msxSize КБ (МБ)**

* **validSizeAllFiles(msxSize, type (default – ‘КБ’))** -  позволяющая загружать файлы, общим размером не превышающих **msxSize КБ (МБ)**


#### Примеры:

> для поля с **id = ‘uForm__name’**, применяется функция проверки длины вводимого текста **validLen(2, 50)**

    ‘uForm__name: {
        validLen: [2, 50]
    },

> для поля с **id = ‘uForm__files’**, применяются две проверочные функции: **validCountFiles(3)** и  **validSizeAllFiles(2, 'МБ')**, позволяющая загружать не более 3-ех файлов и общий размер файлов не превышает 2Мб, иначе выведет уведомление об ошибке


    'uForm__files': {
        validCountFiles: [3],
        validSizeAllFiles: [2, 'МБ'] // KB - default
    }
 
 ![alt text](https://i.imgur.com/DoTcnrw.jpg "JS Config")
 
 

### 4.	Настройка SMTP
Настройка **аккаунта SMTP, почты отправителя, получателей, скрытых получателей, почты технической поддержки**, а также **включение поддержку html тегов** в письме, производиться в файл ‘uform/ UFormConfig.php’.
Каждый параметр детально описан в комментариях и в дополнительном разъяснении не нуждается.

### 5.	Настройка на стороне сервера и оформление письма
* Настройка производиться в файле **‘uForm/sform.php’**
Настройка валидации данных получаемых из формы производиться в трех переменных:

    **$inputs** – массив id форм с которых принимаются данные, список имен всех ожидаемых полей из этих форм и их валидации;

    **$requires** - массив id форм с которых принимаются данные и список обязательных полей в этих формах;

    **$files** - массив id форм с которых принимаются данные, список имен ожидаемых полей типа **‘file’**, для загрузки файлов.
В загружаемом примере, для каждой настройки есть детальный комментарий.
* **$mail_subject** – тема отправляемого письма
* **$mail_body** – тело (сообщение) отправляемого письма. При необходимости можно включить поддержку HTML тегов. См. п. 4

### 6.	Формирование письма

Для формирования письма, можно использовать полученные данные в следующих переменных:
**$formData** - полученные данные из формы в формате **['name1' => 'value1', 'name2' => 'value2'];**

**$formData** также содержит **"uFormId" - id формы**,
можно сделать **if($formData['uFormId'] == 'uForm_any')** и в зависимости от id формы, по-разному формировать письмо;

**$inputs[ $formData['uFormId'] ]** - список всех ожидаемых полей.

При необходимости можно переопределить любую из настроек SMTP через переменную **$customConfig['configParamName'] = configParamVal;**
